#!/bin/bash

# change tables type
sed -i 's/MyISAM/InnoDB/g' $1

# forbid AUTOCOMMIT etc.
sed -i '1i\
SET @OLD_AUTOCOMMIT=@@AUTOCOMMIT, AUTOCOMMIT = 0;\
SET @OLD_UNIQUE_CHECKS=@@UNIQUE_CHECKS, UNIQUE_CHECKS = 0;\
SET @OLD_FOREIGN_KEY_CHECKS=@@FOREIGN_KEY_CHECKS, FOREIGN_KEY_CHECKS = 0;\
\n' $1 

# return settings
sed -i '$a\
SET FOREIGN_KEY_CHECKS=@OLD_FOREIGN_KEY_CHECKS;\
SET UNIQUE_CHECKS=@OLD_UNIQUE_CHECKS;\
SET AUTOCOMMIT = @OLD_AUTOCOMMIT;\
COMMIT;\
\n' $1 


